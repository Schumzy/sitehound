//
//  SiteHound - Easy & powerful website analytics tracking
//
//  Docs: http://www.sitehound.co
//  Source: https://github.com/andyyoung/sitehound
//
//  @author        Andy Young // @andyy // andy@apexa.co.uk
//  @version       0.9.64 - 25th May 2016
//  @licence       GNU GPL v3  http://www.gnu.org/licenses/
//
//  Copyright (C) 2016 Andy Young // andy@apexa.co.uk
//  ~~ 500 Startups Distro Team // #500STRONG // 500.co ~~
//
!function(){function e(){var e=window.sitehound||{},n=a(e.adaptor);n&&n.ready(function(){var e=window.sitehound||{};new t(e,n)})}function t(e,t){function o(){return I.info("Library loaded (version "+s+")"),I.cookieDomain=S(location.hostname),I.debug("Cookie domain: "+I.cookieDomain),y("dnt")?(I.info("Do-not-track cookie present"),void(I.adaptor="disabled")):(y("logToConsole")&&(I.logToConsole=!0),window.sitehound=I,g(),void((e.sniffOnLoad||e.isDone)&&I.sniff()))}function a(e){if(-1!=I.domainsIgnore.indexOf(e))return!0;if(I.domainsIgnoreIPAddress&&/([0-9]{1,3}\.){3}[0-9]{1,3}/.test(e))return!0;for(var t=0;t<I.domainsIgnoreSubdomains.length;t++)if(0==e.indexOf(I.domainsIgnoreSubdomains[t]+"."))return!0;return!1}function d(){I.sniffed=!0,I.page||(I.page=I.detectPage()),I.thisPageTraits["Page Type"]=I.page,void 0!==I.overrideReferrer&&(I.thisPageTraits.referrer=I.thisPageTraits.Referrer=I.thisPageTraits.$referrer=I.overrideReferrer),u();var e=I.adaptor.userTraits();if(e.createdAt&&(I.globalTraits["Days Since Signup"]=Math.floor((new Date-new Date(e.createdAt))/1e3/60/60/24),I.debug("Days since signup: "+I.globalTraits["Days Since Signup"])),I.userTraits["Email Domain"]?I.userTraits["Email Domain"]=I.userTraits["Email Domain"].match(/[^@]*$/)[0]:(e.Email||e.email||I.userTraits.Email)&&(I.userTraits["Email Domain"]=(e.Email||e.email||I.userTraits.Email).match(/[^@]*$/)[0]),window.FS&&window.FS.getCurrentSessionURL)I.globalTraits["Fullstory URL"]=FS.getCurrentSessionURL();else if(!I.sniffed){var t=window._fs_ready;window._fs_ready=function(){I.adaptor.identify({"Fullstory URL":FS.getCurrentSessionURL()}),"function"==typeof t&&t()}}if(I.userId){I.debug("Received userId: "+I.userId);var e={},i=["name","email","createdAt"];for(var o in I.userTraits){for(var a=o.toLowerCase(),s="",d=0;d<i.length;d++)if(a===i[d].toLowerCase()){s=i[d];break}s||(s="User "+n(o)),e[s]=I.userTraits[o]}var g,l=r(I.globalTraits,e);I.adaptor.userId()?(g=I.adaptor.userId(),I.debug("Current userId: "+g)):(I.debug("Anonymous session until now - alias()"),I.adaptor.alias(I.userId),I.adaptor.identify("x")),I.debug("identify("+I.userId+", [traits])"),I.userId!==g&&(l=r(l,b({createdAt:(new Date).toISOString()}))),I.adaptor.identify(I.userId,l),I.userId!==g&&(I.debug("userId != currentUserId - Login"),I.track("Login")),m("logged_out","",-100)}else I.adaptor.identify(I.globalTraits),I.detectLogout=void 0===I.detectLogout?void 0!==I.userId:I.detectLogout,I.detectLogout&&(I.debug("Detecting potential logout.."),I.adaptor.userId()&&(y("logged_out")||(I.track("Logout"),m("logged_out",!0),I.debug("Logout"))));if(I.trackLandingPage&&(c("Landing",I.landingPageTraits),I.trackLandingPage=!1),I.page){var f=I.page.split("|",2).map(function(e){return e.trim()});f.push(I.pageTraits);c.apply(I,f)}else I.trackAllPages&&c("Unidentified")}function u(){var e=y("firstSeen")||(new Date).toISOString();m("firstSeen",e,366);var t=Math.floor((new Date-new Date(e))/1e3/60/60/24);I.globalTraits["First Seen"]=e,I.globalTraits["Days Since First Seen"]=t,I.debug("Visitor first seen: "+e),I.debug("Days since first seen: "+t);var n=y("sessionStarted")||(new Date).toISOString(),i=y("sessionUpdated")||(new Date).toISOString(),o=Math.floor((new Date-new Date(n))/1e3/60),a=Math.floor((new Date-new Date(i))/1e3/60);I.globalTraits["Session Started"]=n,I.globalTraits["Minutes Since Session Start"]=o,I.debug("Session started: "+n),I.debug("Session duration: "+o),I.debug("Minutes since last event: "+a);var s=a>I.sessionTimeout;s&&(I.debug("Session timed out - tracking as new session"),n=(new Date).toISOString()),m("sessionStarted",n),m("sessionUpdated",(new Date).toISOString());var d=(s?0:parseInt(y("pageViews")||0))+1;I.thisPageTraits["Pageviews This Session"]=d,m("pageViews",d),I.debug("Pageviews: "+d);var u,c=document.referrer.match(/https?:\/\/([^\/]+)(\/.*)/),g=null;if(c&&(g=c[1],u=c[2]),g==location.host&&(I.thisPageTraits["Referrer Type"]=I.detectPage(u)),I.isLandingPage=!1,!s){if(d>1)return;I.isLandingPage=!0,I.debug("Detected landing page")}var l=parseInt(y("sessionCount")||0)+1;if(I.globalTraits["Session Count"]=l,m("sessionCount",l,366),I.debug("Session count: "+l),!s){for(var f={},h=["UTM Source","UTM Medium","UTM Campaign","UTM Term","UTM Content","Landing Page","Landing Page Type","Initial Referrer","Initial Referring Domain"],p=0;p<h.length;p++)f[h[p]]=null;var S=T();Object.keys(S).length>0&&(I.debug("utm params:"),I.debug(S),f=r(f,S)),g===location.host?-1!==I.trackReferrerLandingPages.indexOf(u)?(I.debug("Detected known untracked landing page: "+document.referrer),I.trackLandingPage=!0,I.landingPageTraits={path:u,url:document.referrer,$current_url:document.referrer,"Tracked From URL":location.href,referrer:""},f["Landing Page"]=u):document.referrer===location.href?(I.trackLandingPage=!0,f["Landing Page"]=location.pathname):l>1||I.trackDebugWarn("Landing page with local referrer - tracking code not on all pages?"):(I.trackLandingPage=!0,f["Landing Page"]=location.pathname,f["Initial Referrer"]=document.referrer?document.referrer:null,f["Initial Referring Domain"]=g),f["Landing Page"]&&(f["Landing Page Type"]=I.page),f["UTM Source"]||((v(document.URL,"gclid")||v(document.URL,"gclsrc"))&&(f["UTM Source"]="google",f["UTM Medium"]||(f["UTM Medium"]="cpc")),"t.yesware.com"==f["Referring Domain"]&&(f["UTM Source"]="Yesware",f["UTM Medium"]||(f["UTM Medium"]="email")));var k={},w={};for(var L in f)k[L+" [first touch]"]=f[L],w[L+" [last touch]"]=f[L];I.debug("Attribution params:"),I.debug(f),1==l&&(I.debug("..setting first touch params"),I.globalTraits=r(I.globalTraits,b(k))),I.debug("..setting last touch params"),I.globalTraits=r(I.globalTraits,w)}}function c(e,t,n){I.debug("Viewed Page: ",[e,t,n]),"object"==typeof n?I.adaptor.page(e,t,I.getTraitsToSend(n)):"object"==typeof t?I.adaptor.page(e,I.getTraitsToSend(t)):t?I.adaptor.page(e,t,I.getTraitsToSend()):I.adaptor.page(e,I.getTraitsToSend())}function g(){h(f(["ready"]))}function l(){h(f())}function f(e){if(I.queue&&I.queue.length){if(!e||!e.length){var t=I.queue;return I.queue=[],t}for(var n=[],r=[],i=0;i<I.queue.length;i++)-1!==e.indexOf(I.queue[i][0])?n.push(I.queue[i]):r.push(I.queue[i]);return I.queue=r,n}}function h(e){for(;e&&e.length>0;){var t=e.shift(),n=t.shift();I[n]&&I[n].apply(I,t)}}function p(e){I.debug("Detected URL change: "+location.href),I.overrideReferrer=e||document.referrer,I.page=void 0;for(var t=I.detectPage(),n=0;n<D.length;n++)D[n](t);I.sniff()}function m(e,t,n,r){var i="";if(0!=n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i="expires="+o.toUTCString()}void 0===r&&(r=I.cookieDomain),document.cookie="sh_"+e+"="+t+"; "+i+";path=/"+(r?";domain="+r:"")}function y(e){for(var t="sh_"+e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function T(){for(var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",r={},i=0;i<e.length;++i)t=v(document.URL,e[i]),t.length&&(r["UTM "+n(e[i].slice(4))]=t);return r}function v(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+t+"=([^&#]*)",r=new RegExp(n),i=r.exec(e);return null===i||i&&"string"!=typeof i[1]&&i[1].length?"":decodeURIComponent(i[1]).replace(/\+/g," ")}function b(e){var t=I.adaptor.userTraits(),n={};if("undefined"==typeof t)return e;for(var r in e)r in t||(n[r]=e[r]);return n}function S(e){for(var t=k(e),n=0;n<t.length;++n){var r="__tld__",i="."+t[n];if(m(r,1,0,i),y(r))return m(r,"",-100,i),i}return""}function k(e){var t=e.split("."),n=t[t.length-1],r=[];if(4==t.length&&parseInt(n,10)==n)return r;if(1>=t.length)return r;for(var i=t.length-2;i>=0;--i)r.push(t.slice(i).join("."));return r}var w,L,I=this,D=[];return this.adaptor=t,"object"==typeof t&&t.check()?(!function(){var t={trackPages:null,page:null,trackAllPages:!1,detectURLChange:!0,detectHashChange:!1,domainsIgnore:["localhost","gtm-msr.appspot.com"],domainsIgnoreIPAddress:!0,domainsIgnoreSubdomains:["staging","test"],trackReferrerLandingPages:[],globalTraits:{},pageTraits:{},thisPageTraits:{},userId:void 0,userTraits:{},detectLogout:void 0,logToConsole:!1,silent:!1,sessionTimeout:30,overrideReferrer:void 0,queue:[],SNIPPET_VERSION:void 0};I.sniffed=!1;for(var n in t)void 0!==e[n]&&(t[n]=e[n]),I[n]=t[n];I.thisPageTraits["SiteHound library version"]=I.VERSION=s}(),this.sniff=this.done=function(){try{if(I.debug("Sniffing.."),a(location.hostname))return I.info("Ignoring host: "+location.hostname),void(I.adaptor="disabled");if(y("dnt"))return I.info("do-not-track cookie present"),void(I.adaptor="disabled");var e=!I.sniffed;if(d(),!e)return;l(),!I.detectURLChange&&!I.detectHashChange||w||(L=location.href,w=setInterval(function(){(I.detectHashChange?location.href!==L:location.href.replace(/#.*$/,"")!==L.replace(/#.*$/,""))&&(p(L),L=location.href)},1e3))}catch(t){this.trackError(t)}},this.deferUntilSniff=function(e,t){return I.sniffed?!1:(t=Array.prototype.slice.call(t),t.unshift(e),I.queue.push(t),I.debug("(Deferring "+e+"() until sniff)"),!0)},this.identifyOnce=function(e){I.deferUntilSniff("identifyOnce",arguments)||(I.debug("identifyOnce",e),I.adaptor.identify(b(e)))},this.detectPage=function(e){void 0===e&&(e=location.pathname);for(var t in I.trackPages){var n=I.trackPages[t];Array.isArray(n)||(n=[n]);for(var r=0;r<n.length;++r){var o=n[r];if("function"==typeof o.test){if(o.test(e))return I.debug("Detected page: "+t),t}else if("."===o[0]){if(e===location.pathname&&document.body.className.match(new RegExp("(?:^|\\s)"+i(o.slice(1))+"(?!\\S)")))return I.debug("Detected page: "+t),t}else if(e.replace(/\/$/,"").match(new RegExp("^"+i(o.replace(/\/$/,"")).replace(/\\\*/g,".*")+"$")))return I.debug("Detected page: "+t),t}}},this.getTraitsToSend=function(e){var t=r(I.globalTraits,I.thisPageTraits);return"object"==typeof e?r(t,e):t},this.info=function(e,t){I.silent||I.log(e,t)},this.debug=function(e,t){I.logToConsole&&I.log(e,t)},this.log=function(e,t){if(window.console&&console.log)try{var n="[SiteHound] ";"object"==typeof e?JSON&&JSON.stringify&&(e=n+JSON.stringify(e)):e=n+e,t&&JSON&&JSON.stringify&&(e=e+"("+JSON.stringify(t).slice(1).slice(0,-1)+")",t=null),console.log(e),t&&console.log(t)}catch(r){I.trackError(r)}},this.doNotTrack=function(e){e="undefined"==typeof e?!0:!!e,e?m("dnt","1",1e3):m("dnt","",-100),I.debug("doNotTrack",e?"true":"false")},this.debugMode=function(e){I.logToConsole=e="undefined"==typeof e?!0:!!e,e?m("logToConsole","1",1e3):m("logToConsole","",-100),I.debug("doNotTrack",e?"true":"false")},this.onURLChange=this.onUrlChange=function(e){"function"==typeof e?(this.debug("onURLChange()"),D.push(e)):window.console&&console.error&&console.error("[SiteHound] onURLChange() called with something that isn't a function")},void o()):void(window.console&&console.error&&console.error("[SiteHound] adaptor not valid"))}function n(e){return"string"==typeof e?e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):e}function r(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}function i(e){return e.replace(/([\/*.?[\]()\-\|])/g,"\\$1")}function o(e,t){d[e]=t}function a(e){var t,n;if("object"==typeof e)n=e;else{t=(e||"segment").toLowerCase()||"segment";try{var n=new d[t]}catch(r){return void(window.console&&console.error&&(console.error("[SiteHound] adaptor "+t+" could not be loaded"),console.error("[SiteHound] "+r.name+"; "+r.message)))}}return n.check()?n:void(window.console&&console.error&&console.error("[SiteHound] failed to attach to "+(t?t:"adaptor")))}var s="0.9.64",d={};t.prototype.identify=function(e,t){this.deferUntilSniff("identify",arguments)||(this.debug("identify",[e,t]),this.adaptor.identify(e,t))},t.prototype.track=function(e,t){this.deferUntilSniff("track",arguments)||(t="object"==typeof t?this.getTraitsToSend(t):this.getTraitsToSend(),this.debug("track",[e,t]),this.adaptor.track(e,t))},t.prototype.trackOnce=function(e,t){if(!this.deferUntilSniff("trackOnce",arguments)){this.debug("trackOnce",[e,t]);var n=this.adaptor.userTraits();if(void 0===n["First "+e]){var r={};r["First "+e]=(new Date).toISOString(),this.adaptor.identify(r),this.track(e,t)}}},t.prototype.trackAndCount=function(e,t){if(!this.deferUntilSniff("trackAndCount",arguments)){this.debug("trackAndCount",[e,t]);var n=this.adaptor.userTraits(),r=1;n&&(r=n[e+" Count"]?parseInt(n[e+" Count"])+1:1);var i={};i["First "+e]=(new Date).toISOString(),this.identifyOnce(i);var o={};o[e+" Count"]=r,o["Last "+e]=(new Date).toISOString(),this.adaptor.identify(o),this.track(e,t)}},t.prototype.trackLink=function(e,t){if(!this.deferUntilSniff("trackLink",arguments)){var n={};e&&e.selector&&(n.selector=e.selector),e&&e.length&&(n.length=e.length),this.debug("trackLink",[n,t]),this.adaptor.trackLink(e,t,this.getTraitsToSend())}},t.prototype.trackForm=function(e,t){if(!this.deferUntilSniff("trackForm",arguments)){var n={};e&&e.selector&&(n.selector=e.selector),e&&e.length&&(n.length=e.length),this.debug("trackForm",[n,t]),this.adaptor.trackForm(e,t,this.getTraitsToSend())}},t.prototype.ready=function(e){if("function"==typeof e){var t=this.detectPage();this.debug("ready("+t+")"),e(t)}else window.console&&console.error&&console.error("[SiteHound] ready() called with something that isn't a function")},t.prototype.getUserTraits=function(){return result=r(this.adaptor.userTraits(),this.userTraits),this.debug("getUserTraits() returned ",result),result},t.prototype.load=function(e){this.debug("load() called when already loaded"),e&&(this.debug("updating adaptor to: "+e),this.adaptor=a(e))},t.prototype.trackDebugInfo=function(e){this.trackDebug(e,"info")},t.prototype.trackDebugWarn=function(e){this.trackDebug(e,"warn")},t.prototype.trackDebug=function(e,t){t||(t="info"),this.adaptor.track("Tracking Debug",{message:e,level:t,"SiteHound library version":this.VERSION}),this.debug("["+t+"] "+e)},t.prototype.trackError=function(e){this.adaptor.track("Tracking Error",{name:e.name,message:e.message,"SiteHound library version":this.VERSION}),window.console&&console.error&&console.error("[SiteHound] "+e.name+"; "+e.message)},o("disabled",function(){this.check=this.ready=this.identify=this.track=this.trackLink=this.trackForm=this.page=this.alias=this.userId=this.userTraits=function(){}}),o("segment",function(){window.analytics=window.analytics||[];return this.check=function(){return"undefined"!=typeof analytics.ready},this.check()?(this.ready=function(e){analytics.ready(e)},this.identify=function(e,t){analytics.identify(e,t)},this.track=function(e,t){analytics.track(e,t)},this.trackLink=function(e,t,n){analytics.trackLink(e,t,n)},this.trackForm=function(e,t,n){analytics.trackForm(e,t,n)},this.page=function(e,t,n){analytics.page(e,t,n)},this.alias=function(e){analytics.alias(e)},this.userId=function(){var e=analytics.user();return e?e.id():void 0},void(this.userTraits=function(){var e=analytics.user(),t=e.traits();return t})):void(window.console&&console.error&&console.error("[SiteHound] window.analytics is not initialized - ensure analytics.js snippet is included first"))}),e()}();